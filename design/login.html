<!DOCTYPE html>
<html lang="en">
<head>
    <title>Spotify API Tutorial</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles/spotify.css">
    <link rel="icon" href="https://open.spotifycdn.com/cdn/images/favicon.0f31d2ea.ico">
</head>
<body>
    <header>
        <h1>Spotify API Tutorial</h1>
        <nav>
            <a href="index.html" class="selected">Walkthrough</a>
            <a href="demo/index.html">Demo</a>
            <a href="https://developer.spotify.com/documentation/web-api/">API Reference</a>
        </nav>
    </header>

    <main>
        <section class="card">
            <p>Paste your Client ID here: <input id="paste-client-id" data-sync="client_id" type="text" size="40" placeholder="Client ID"> <span class="note">(we won't steal it, promise!)</span></p>
        <section class="card">
            <ul>
                <li>
                    <code>client_id</code>: <input id="login-client-id" data-sync="client_id" type="text" size="40" placeholder="Client ID">
                </li>
                <li>
                    <code>redirect_uri</code>: <input id="login-redirect-uri" data-sync="redirect_uri" type="text" size="40" placeholder="Redirect URI"> <span class="note">(This should be a page that is prepared to handle the returned auth code)</span>
                </li>
            </ul>

            <h3 id="making-the-request">Making the Request</h3>
            <p></p>
            <ul>
                <li><code>code_verifier</code>: <code id="code-verifier" class="graybg"></code></li>
                <li><code>code_challenge</code>: <code id="code-challenge" class="graybg"></code></li>
            </ul>
            <!-- HTML generated using hilite.me -->

            <h3 id="try-login">Try It Yourself!</h3>
            <button id="login-button" class="primary" type="button">Login with Spotify</button>
            <p>Your auth code is: <code id="auth-code" class="graybg"></code></p>
        </section>
        <section class="card">
            <!-- HTML generated using hilite.me -->
            <div class="code-display">
                <pre style="margin: 0; line-height: 125%"><span style="color: #008000; font-weight: bold">const</span> urlParams <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> URLSearchParams(<span style="color: #008000">window</span>.location.search);
<span style="color: #008000; font-weight: bold">const</span> authCode <span style="color: #666666">=</span> urlParams.get(<span style="color: #BA2121">&#39;code&#39;</span>);
</pre>
            </div>


            <p>Here is an example of a request that exchanges the auth code for an access token:</p>

            <!-- HTML generated using hilite.me -->
            <div class="code-display">
                <pre style="margin: 0; line-height: 125%"><span style="color: #408080; font-style: italic">// codeVerifier MUST be the same as the one used to make the code challenge for the auth request</span>
<span style="color: #008000; font-weight: bold">const</span> codeVerifier <span style="color: #666666">=</span> localStorage.getItem(<span style="color: #BA2121">&#39;code_verifier&#39;</span>);

<span style="color: #008000; font-weight: bold">const</span> payload <span style="color: #666666">=</span> {
    method<span style="color: #666666">:</span> <span style="color: #BA2121">&#39;POST&#39;</span>,
    headers<span style="color: #666666">:</span> {
        <span style="color: #BA2121">&#39;Content-Type&#39;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&#39;application/x-www-form-urlencoded&#39;</span>,
    },
    body<span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">new</span> URLSearchParams({
        grant_type<span style="color: #666666">:</span> <span style="color: #BA2121">&#39;authorization_code&#39;</span>,
        client_id<span style="color: #666666">:</span> <span style="color: #BA2121">&#39;<span data-sync="client_id"></span>&#39;</span>,
        redirect_uri<span style="color: #666666">:</span> <span style="color: #BA2121">&#39;<span data-sync="redirect_uri"></span>&#39;</span>,
        code_verifier<span style="color: #666666">:</span> codeVerifier,
        code<span style="color: #666666">:</span> authCode, <span style="color: #408080; font-style: italic">// From the URL</span>
    }),
}

<span style="color: #008000; font-weight: bold">const</span> response <span style="color: #666666">=</span> await fetch(<span style="color: #BA2121">&#39;https://accounts.spotify.com/api/token&#39;</span>, payload);
<span style="color: #008000; font-weight: bold">const</span> data <span style="color: #666666">=</span> await response.json();

<span style="color: #008000; font-weight: bold">const</span> accessToken <span style="color: #666666">=</span> data.access_token;
</pre>
            </div>

            <h3 id="try-token">Try It Yourself!</h3>
            <p>If you've successfully obtained an auth code, you can click this button to exchange it for an access token:</p>
            <button id="token-button" class="primary" type="button">Get Access Token</button>
            <p>Your access token is: <code id="access-token" class="graybg"></code></p>
            <p class="note">This token will last for an hour, after which you will need to request a new one. There is a mechanism to <a href="https://developer.spotify.com/documentation/web-api/tutorials/refreshing-tokens">refresh the token</a>, so the user doesn't need to log in again.</p>

        </section>

            <h3 id="try-api">Try It Yourself!</h3>
            <p>If you've successfully obtained an access token, you can click this button to get the current user's profile:</p>
            <button id="profile-button" class="primary" type="button">Get User Profile</button>
            <p>Your user profile is: <code id="profile-name" class="graybg"></code></p>
            <img id="profile-image" src="https://placehold.co/300x300" alt="User profile">
        </section>
    </main>

    <footer>
        <p>Created with ❤️ for CS 343: Application Development, James Madison University.</p>
    </footer>

    <script src="../scripts/script.js"></script>
</body>
</html>