
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Spotify API Tutorial</title>
    <meta charset="UTF-8">
    <link rel="icon" href="https://open.spotifycdn.com/cdn/images/favicon.0f31d2ea.ico">
</head>
<body>
    <header>
        <h1>Spotify API Tutorial</h1>
        <nav>
            <a href="index.html" class="selected">Walkthrough</a>
            <a href="demo/index.html">Demo</a>
            <a href="https://developer.spotify.com/documentation/web-api/">API Reference</a>
        </nav>
    </header>

    <main>

        <section class="card">
            
          <p>Client ID: <input id="paste-client-id" data-sync="client_id" value="bca2a89f33694250b5b79633e3435a39"></p>


            
        </section>
        <section class="card">
            <h2 id="getting-an-authorization-code">2. Getting an Authorization Code</h2>
           

            <ul>
                <li>
                    <code>client_id</code>: <input id="login-client-id" data-sync="client_id" value="bca2a89f33694250b5b79633e3435a39" placeholder="Client ID">
                </li>
                <li>
                    <code>redirect_uri</code>: <input id="login-redirect-uri" data-sync="redirect_uri" value="https://mart32jm.github.io/design/login.html" placeholder="Redirect URI"> <span class="note">(This should be a page that is prepared to handle the returned auth code)</span>
                </li>
            </ul>

            <h3 id="making-the-request">Making the Request</h3>
            <p></p>

            <p>You will need code to generate a <code>code_challenge</code> and a <code>code_verifier</code>. Spotify provides source code to create these in its <a href="https://developer.spotify.com/documentation/web-api/tutorials/code-pkce-flow#code-verifier">developer documentation</a>. You should use their provided code in your own project.</p>

            <p>Here are the values we've generated for this tutorial: <button id="generate-button" type="button" class="small">Regenerate</button></p>

            <ul>
                <li><code>code_verifier</code>: <code id="code-verifier" class="graybg"></code></li>
                <li><code>code_challenge</code>: <code id="code-challenge" class="graybg"></code></li>
            </ul>

            <p>You should generate your own values programatically each time you make a new authorization request. You will need to store the <code>code_verifier</code> in <code>localStorage</code>, since the page will be reloaded after Spotify redirects the user. Read <a href="#code-verifier-and-code-challenge">the section below</a> to see why this is important!</p>

            <p>Here is an example of making the authorization request via JavaScript (updated with your request values):</p>


            <aside>
                <h4 id="code-verifier-and-code-challenge">Learn More: Code Verifier and Code Challenge</h4>
                <p>When you send the authorization request, you must provide a "code challenge" to the server. This code challenge is a one-way hash of a random string known as the "code verifier".</p>
                <p>You first give the <em>code challenge</em> when sending the user to Spotify to login. The server will return an <em>authorization code</em> back to your app <span class="note">(which could be stolen by an attacker, since it is given in the URL)</span>.</p>
                <p>Then you send the <em>authorization code</em> to Spotify in a <code>POST</code> request. But this time, you include the original <em>code verifier</em> string! The server can re-hash the <em>code verifier</em> and make sure it matches the <em>code challenge</em> you sent earlier. This way, it's able to ensure that you are the same one who sent the original request. This is the basis for PKCE. You can read more about it <a href="https://pazel.dev/teach-me-pkce-proof-key-for-code-exchange-in-5-minutes">here</a>.</p>
            </aside>

            <h3 id="try-login">Try It Yourself!</h3>
            <p>If you've set the <code>client_id</code> and the <code>redirect_uri</code> above, you can click this button to request an authorization code:</p>
            <button id="login-button" class="primary" type="button">Login with Spotify</button>
            <p>Your auth code is: <code id="auth-code" class="graybg"></code></p>
        </section>
        <section class="card">
            <h2 id="exchanging-the-auth-code">3. Exchanging the Authorization Code for an Access Token</h2>
            <p>Once you have the authorization code, you can exchange it for an access token. This token is what you will use to make requests to the Spotify API. If you have successfully requested an auth code, it should be present in the URL's <em>query string</em>.</p>

            <p>You can get the auth code from the URL like so, using URLSearchParams to parse the query string (<a href="https://www.jackfranklin.co.uk/blog/url-search-params/">read more!</a>):</p>

            <!-- HTML generated using hilite.me -->

            <h3 id="making-the-token-request">Making the Request</h3>
            
            <ul>
                <li><code>grant_type</code>: <code class="graybg">"authorization_code"</code> <span class="note">(a string literal)</span></li>
                <li><code>client_id</code>: <code data-sync="client_id" class="graybg"></code> <span class="note">(same as before)</span></li>
                <li><code>redirect_uri</code>: <code data-sync="redirect_uri" class="graybg"></code> <span class="note">(same one used to request the auth code)</span></li>
                <li><code>code_verifier</code>: <code id="code-verifier-body" class="graybg"></code> <span class="note">(value from <code>localStorage</code>)</span></li>
                <li><code>code</code>: <code id="auth-code-body" class="graybg"></code> <span class="note">(from the URL)</span></li>
            </ul>

            <p>Access Token:</p>
            <button id="token-button" class="primary" type="button">Get Access Token</button>
            <p>Your access token is: <code id="access-token" class="graybg"></code></p>

        </section>
        <section class="card">

            <button id="profile-button" class="primary" type="button">Get User Profile</button>
            <p>Your user profile is: <code id="profile-name" class="graybg"></code></p>
            <img id="profile-image" src="https://placehold.co/300x300" alt="User profile">
        </section>
    </main>

    <script src="../scripts/spotify.js"></script>
    <script src="../scripts/tutorial.js"></script>
</body>
</html>